const { readEnv } = require('../lib/database');
const { cmd } = require('../command');

// ========== MENU COMMAND ==========
cmd({
    pattern: "menu",
    react: "ğŸ“œ",
    desc: "Display interactive bot menu",
    category: "main",
    filename: __filename,
},
async (conn, mek, m, { from, reply, pushname }) => {
    try {
        // Forwarding Metadata
        const contextInfo = {
            forwardingScore: 999,
            isForwarded: true,
            forwardedNewsletterMessageInfo: {
                newsletterName: "HYPER-MD",
                newsletterJid: "120363325937635174@newsletter",
            },
            externalAdReply: {
                title: "HYPER-MD Bot Menu",
                body: "Â©á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ",
                thumbnailUrl: "https://telegra.ph/file/3c64b5608dd82d33dabe8.jpg",
                mediaType: 1,
                renderLargerThumbnail: true,
            },
        };

        // Bot Menu Content
        const botMenu = `
ğŸ‘‹ ğ™·ğšğš•ğš•ğš˜, ${pushname || "User"}

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ”¢ ğ™¿ğ™»ğ™´ğ™°ğš‚ğ™´ ğš‚ğ™´ğ™»ğ™´ğ™²ğšƒ ğ™° ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ 1 || ğ™³ğ™¾ğš†ğ™½ğ™»ğ™¾ğ™°ğ™³ ğ™¼ğ™´ğ™½ğš„
â”œ 2 || ğ™¼ğ™°ğ™¸ğ™½ ğ™¼ğ™´ğ™½ğš„
â”œ 3 || ğ™¶ğšğ™¾ğš„ğ™¿ ğ™¼ğ™´ğ™½ğš„
â”œ 4 || ğ™¾ğš†ğ™½ğ™´ğš ğšƒğ™¾ğ™¾ğ™»ğš‚
â”œ 5 || ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ ğ™¼ğ™´ğ™½ğš„
â”œ 6 || ğš‚ğ™´ğ™°ğšğ™²ğ™· ğ™¼ğ™´ğ™½ğš„
â”œ 7 || ğ™¼ğ™¾ğš…ğ™¸ğ™´ ğ™¼ğ™´ğ™½ğš„
â”œ 8 || ğ™¾ğšƒğ™·ğ™´ğš ğ™¼ğ™´ğ™½ğš„
â”œ 9 || ğ™°ğ™¸ ğ™¼ğ™´ğ™½ğš„
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
        `;

        // Send Menu with ContextInfo
        const sentMsg = await conn.sendMessage(
            from,
            {
                text: botMenu,
                contextInfo,
            },
            { quoted: mek }
        );

        // Listen for User Responses
        conn.ev.on('messages.upsert', async (msgUpdate) => {
            try {
                const userMsg = msgUpdate.messages[0];
                if (!userMsg.message || !userMsg.message.extendedTextMessage) return;

                const selectedOption = userMsg.message.extendedTextMessage.text.trim();

                // Validate if user is responding to the Menu Message
                if (
                    userMsg.message.extendedTextMessage.contextInfo &&
                    userMsg.message.extendedTextMessage.contextInfo.stanzaId === sentMsg.key.id
                ) {
                    let responseText = "";
                    switch (selectedOption) {
                        case '1': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ“¥ ğ™³ğ™¾ğš†ğ™½ğ™»ğ™¾ğ™°ğ™³ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğ™µğ™±
â”œ .ğšƒğ™¸ğ™ºğšƒğ™¾ğ™º
â”œ .ğ™¸ğ™¼ğ™¶
â”œ .ğ™°ğ™¿ğ™ºğ™³ğ™»
â”œ .ğ™¶ğ™³ğšğ™¸ğš…ğ™´
â”œ .ğ™¿ğ™»ğ™°ğšˆ
â”œ .ğš…ğ™¸ğ™³ğ™´ğ™¾
â”œ .ğš…ğ™¸ğ™³ğ™´ğ™¾2
â”œ .ğš‚ğ™¾ğ™½ğ™¶
â”œ .ğš‚ğ™¾ğ™½ğ™¶2
â”œ .ğšƒğš†ğ™¸ğšƒğ™´ğš
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '2': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ›  ğ™¼ğ™°ğ™¸ğ™½ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğ™°ğ™»ğ™¸ğš…ğ™´
â”œ .ğ™¿ğ™¸ğ™½ğ™¶
â”œ .ğ™¼ğ™´ğ™½ğš„
â”œ .ğ™°ğ™»ğ™»ğ™¼ğ™´ğ™½ğš„
â”œ .ğšğš„ğ™½ğšƒğ™¸ğ™¼ğ™´
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '3': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ‘¥ ğ™¶ğšğ™¾ğš„ğ™¿ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğšƒğ™°ğ™¶ğ™°ğ™»ğ™»
â”œ .ğ™°ğ™³ğ™³
â”œ .ğ™ºğ™¸ğ™²ğ™º
â”œ .ğ™¿ğšğ™¾ğ™¼ğ™¾ğšƒğ™´
â”œ .ğ™³ğ™´ğ™¼ğ™¾ğšƒğ™´
â”œ .ğ™»ğ™¾ğ™²ğ™º
â”œ .ğ™¶ğ™´ğšƒğ™¹ğ™¸ğ™³
â”œ .ğš‚ğ™´ğšƒğš†ğ™´ğ™»ğ™²ğ™¾ğ™¼ğ™´
â”œ .ğš‚ğ™´ğšƒğ™¶ğ™¾ğ™¾ğ™³ğ™±ğšˆğ™´
â”œ .ğ™³ğ™´ğ™»
â”œ .ğš„ğ™¼ğ™¼ğš„ğšƒğ™´
â”œ .ğ™¼ğš„ğšƒğ™´
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '4': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ            
â”‚ğŸ‘‘ ğ™¾ğš†ğ™½ğ™´ğš ğšƒğ™¾ğ™¾ğ™»ğš‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğš‚ğ™·ğš„ğšƒğ™³ğ™¾ğš†ğ™½
â”œ .ğ™±ğšğ™¾ğ™°ğ™µğ™²ğ™°ğš‚ğšƒ
â”œ .ğš‚ğ™´ğšƒğ™¿ğ™¿
â”œ .ğ™±ğ™»ğ™¾ğ™²ğ™º
â”œ .ğš„ğ™½ğ™±ğ™»ğ™¾ğ™²ğ™º
â”œ .ğ™²ğ™»ğ™´ğ™°ğšƒğ™²ğ™·ğ™°ğšƒğ™´
â”œ .ğšğ™´ğš‚ğšƒğ™°ğšğšƒ
â”œ .ğš„ğ™¿ğ™³ğ™°ğšƒğ™´
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '5': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ”„ ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğšƒğ™¾ğ™¼ğ™¸ğ™¶
â”œ .ğš‚ğšƒğ™¸ğ™ºğ™´ğš
â”œ .ğšƒğ™¾ğ™¼ğ™¿3
â”œ .ğšƒğ™¾ğ™¼ğ™¿4
â”œ .ğ™¸ğ™¼ğ™¶2ğš„ğšğ™»
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '6': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ğŸ” ğš‚ğ™´ğ™°ğšğ™²ğ™· ğ™¼ğšğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğšˆğšƒğš‚ğ™´ğ™°ğšğ™²ğ™·
â”œ .ğ™»ğšˆğšğ™¸ğ™²
â”œ .ğš†ğ™¸ğ™ºğ™¸
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                        case '7': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ ğŸ¬ ğ™¼ğ™¾ğš…ğ™¸ğ™´ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğ™¼ğ™¾ğš…ğ™¸ğ™´
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                        }
                            case '8': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ ğŸ‘¨â€ğŸ’» ğ™¾ğšƒğ™·ğ™´ğš ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğ™°ğ™½ğ™¸ğ™¼ğ™´1
â”œ .ğ™°ğ™½ğ™¸ğ™¼ğ™´2
â”œ .ğ™°ğ™½ğ™¸ğ™¼ğ™´3
â”œ .ğ™°ğ™½ğ™¸ğ™¼ğ™´4
â”œ .ğ™°ğ™½ğ™¸ğ™¼ğ™´5
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                            }
                            case '9': {
                            responseText = `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ
â”‚ ğŸ¤– ğ™°ğ™¸ ğ™¼ğ™´ğ™½ğš„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œ .ğ™°ğ™¸
â”œ .ğ™¿ğšğ™¿ğ™³ğ™¸ğ™°2
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—ˆ

Â© á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á´Ê€ êœ±á´‡É´á´‡êœ±Êœ
                            `;
                            break;
                            }
                        default: {
                            responseText = "âŒ Invalid option. Please select a valid number (1-7).";
                        }
                    }

                    // Send Selected Menu
                    await conn.sendMessage(from, { text: responseText, contextInfo }, { quoted: userMsg });
                }
            } catch (error) {
                console.error("Error handling response: ", error);
            }
        });
    } catch (e) {
        console.error("Error in Menu Command: ", e);
        reply("âŒ An error occurred while processing your request.");
    }
});
